package com.marklasater.malware.service.impl;

import com.marklasater.malware.service.HttpService;
import com.mashape.unirest.http.JsonNode;
import com.mashape.unirest.http.Unirest;
import com.mashape.unirest.http.exceptions.UnirestException;
import com.mashape.unirest.request.GetRequest;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import java.util.Map;

@Service
@Slf4j
public class HttpServiceImpl implements HttpService {

    public JsonNode getJson(String url, Map<String, String> headers){
        try {
            return get(url, headers).asJson().getBody();
        } catch(UnirestException e){
            log.error("Failed to load endpoint data.  Url: [{}], Headers: ", url, headers, e);
        }
        return new JsonNode("{}");
    }

    public String getString(String url, Map<String, String> headers){
        try {
            return get(url, headers).asString().getBody();
        } catch(UnirestException e){
            log.error("Failed to load endpoint data.  Url: [{}], Headers: ", url, headers, e);
        }
        return "";
    }

    private GetRequest get(String url, Map<String, String> headers){
        GetRequest request =  Unirest.get(url);
        headers.keySet().stream().forEach(header -> request.header(header, headers.get(header)));

        return request;
    }
}

package com.marklasater.malware.service.impl;

import com.marklasater.malware.model.IpAddressInfo;
import com.marklasater.malware.model.MalwareReport;
import com.marklasater.malware.service.FeedParser;
import com.marklasater.malware.service.HttpService;
import mockit.Expectations;
import mockit.Injectable;
import mockit.Tested;
import org.junit.Assert;
import org.junit.Test;

import java.util.ArrayList;
import java.util.List;

public class MalwareDataServiceIT {

    @Tested
    MalwareDataServiceImpl malwareDataService;

    @Injectable
    HttpService httpService;

    @Injectable
    FeedParser malwareFeedParser;

    @Test
    public void getData(){
        List<MalwareReport> malwareReports = new ArrayList<>();
        MalwareReport malwareReport = new MalwareReport();
        malwareReport.setBaseUrl("google.com");
        malwareReports.add(malwareReport);
        new Expectations(){{
            malwareFeedParser.parseCsvFeed(anyString);
            result = malwareReports;
        }};
        List<MalwareReport> actualResult = malwareDataService.getData();
        Assert.assertNotNull(actualResult);
        Assert.assertEquals(1, actualResult.size());
    }

    @Test
    public void getIpAddressInformation(){
        IpAddressInfo actualResponse = malwareDataService.getIpAddressInformation("google.com");
        Assert.assertNotNull(actualResponse);
    }
}

import Vue from 'vue'
import { shallowMount } from 'vue-test-utils'
import MapView from '@/components/MapView'

Vue.config.ignoredElements = [
  'gmap-map', 'gmap-info-window', '', 'md-button', 'md-toolbar', 'gmap-marker'
];

describe('MapView.spec.js', () => {
  let cmp, vm

  beforeEach(() => {
    cmp = Vue.extend(MapView) // Create a copy of the original component
    vm = new cmp({
      data: {
        iconOnlineThreat: 'http://maps.google.com/mapfiles/kml/paddle/grn-stars-lv.png',
        iconOfflineThreat: 'http://maps.google.com/mapfiles/kml/paddle/blu-square-lv.png',
        currentMapIndex: null,
        infoOptions: {
          pixelOffset: {
            width: 0,
            height: -15
          }
        },
        infoWindowContent: null,
        infoWindowPosition: null,
        infoWindowOpen: false
      },
      propsData: {
        malwareData: [{id: 1}]
      },
    }).$mount()
  })

  it('Received Malware Data prop', () => {
    expect(vm.malwareData[0].id).toEqual(1)
  })

  it('online threat gets online icon', () => {
    expect(vm.getMapIcon({urlStatus: 'online'})).toEqual(vm.iconOnlineThreat)
  })

  it('offline threat gets offline icon', () => {
    expect(vm.getMapIcon({urlStatus: 'offline'})).toEqual(vm.iconOfflineThreat)
  })

  it('toggle window - click to open then close', () => {
    let malwareItem =  {
      url: 'url',
      ipAddressInfo: {
        lat: 123,
        lon: 456
      }
    }

    // Open window.  Verify information and that window is open
    vm.toggleInfoWindow(malwareItem, 4)
    expect(vm.infoWindowPosition.lat).toEqual(malwareItem.ipAddressInfo.lat)
    expect(vm.infoWindowPosition.lng).toEqual(malwareItem.ipAddressInfo.lon)
    expect(vm.infoWindowContent).toEqual(malwareItem.url)
    expect(vm.currentMapIndex).toEqual(4)
    expect(vm.infoWindowOpen).toEqual(true)

    // Click same item.  Window should close
    vm.toggleInfoWindow(malwareItem, 4)
    expect(vm.infoWindowOpen).toEqual(false)
    expect(vm.currentMapIndex).toEqual(4)

    // Click same item.  Window should open
    vm.toggleInfoWindow(malwareItem, 4)
    expect(vm.infoWindowOpen).toEqual(true)
    expect(vm.currentMapIndex).toEqual(4)

    // Click different item with window open. Window should stay open with new index
    vm.toggleInfoWindow(malwareItem, 5)
    expect(vm.infoWindowOpen).toEqual(true)
    expect(vm.currentMapIndex).toEqual(5)
  })


  it('get malware items with location data', () => {
      vm.malwareData = []
    expect(vm.malwareWithLocationInfo.length).toEqual(0)

    vm.data = null
    expect(vm.malwareWithLocationInfo.length).toEqual(0)


    vm.malwareData = [{
      ipAddressInfo: {
        lat: 123,
        lon: 456
      }
    }]
    expect(vm.malwareWithLocationInfo.length).toEqual(1)
  })

})

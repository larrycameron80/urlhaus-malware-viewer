<template>
    <div style="background-color: #f9f9f9;">
      <ag-grid-vue style="width: 100%; height: 40vh;"
                   class="ag-theme-balham"
                   :enableSorting="true"
                   :enableFilter="true"
                   :rowData="rowData"
                   :columnDefs="columnDefs"
                   :gridOptions="gridOptions"
                   :pagination="true"
                   :paginationAutoPageSize="true"
                   :enableColResize="true"
                   :filterModified="filterChanged">
      </ag-grid-vue>
    </div>
</template>

<script>

import {AgGridVue} from 'ag-grid-vue'

export default {
  name: 'TableView',
  components: {AgGridVue},
  props: ['malwareData'],
  data () {
    return {
      columnDefs: null,
      rowData: this.malwareData,
      filtered: [],
      searchTerm: '',
      gridOptions: {}
    }
  },
  methods: {
    filterChanged () {
      // Detemine which items are displayed based off filter
      this.filtered = []
      this.gridOptions.api.forEachNodeAfterFilterAndSort(function (node) {
        this.filtered.push(node.data)
      }.bind(this))

      // Pass filtered items to parent, so Map and Graph can update
      this.$emit('filterUpdated', this.filtered)
    },
    getWindowWidth () {
      // Resize grid columns on window resize
      this.gridOptions.api.sizeColumnsToFit()
    },

    getWindowHeight () {
      // Resize grid columns on window resize
      this.gridOptions.api.sizeColumnsToFit()
    }
  },
  watch: {
    malwareData: function () {
      this.rowData = this.malwareData
      this.gridOptions.api.sizeColumnsToFit()
    }
  },
  mounted () {
    this.$nextTick(function () {
      window.addEventListener('resize', this.getWindowWidth)
      window.addEventListener('resize', this.getWindowHeight)
      this.getWindowWidth()
      this.getWindowHeight()
    })
  },
  beforeMount () {
    this.columnDefs = [
      {headerName: 'Id', field: 'id'},
      {headerName: 'Status', field: 'urlStatus'},
      {headerName: 'Date Added', field: 'dateAdded'},
      {headerName: 'Url', field: 'url'},
      {headerName: 'Threat Type', field: 'threat'},
      {headerName: 'Threat Tags', field: 'tags'},
    ]
  },
  beforeDestroy () {
    window.removeEventListener('resize', this.getWindowWidth)
    window.removeEventListener('resize', this.getWindowHeight)
  }
}
</script>

<style scoped>
</style>
